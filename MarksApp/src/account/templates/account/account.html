{% extends 'base.html' %}

{% block content %}

<style type="text/css">
    .form-signin {
        width: 100%;
        max-width: 330px;
        padding: 15px;
        margin: 0 auto;
    }

    .form-signin .form-control {
        position: left;
        box-sizing: border-box;
        height: auto;
        padding: 10px;
        font-size: 16px;
    }

    .form-signin .form-control:focus {
        z-index: 2;
    }

    .class-entry-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .class-entry {
        display: flex;
        flex-direction: row; /* Align items horizontally */
        margin-bottom: 10px;
    }

    .class-info {
        margin-right: 20px;
    }

    .class-info:first-child {
        margin-left: -200px; /* Add a margin-left of 1px to the first child */
    }
</style>


<!--COMMENTED OUT THIS BELOW -->
<form class="form-signin" method="post">{% csrf_token %}
        
    <div class="text-center">
        <img class="h3 mb-4" src="https://campus757.com/wp-content/uploads/2022/02/wm_720_480.jpg" alt="" width="150" height="100">
    </div>
    {% if jsonData %}
    <ul>
        {% for entry in jsonData %}
        <!--Big O (N)-->
            {% if entry.CRN_ID == CRN %}
                    <div class="class-info">
                        <strong>CRN:</strong> {{ entry.CRN_ID }}<br>
                    </div>
                    <div class="class-info">
                        <strong>Course ID:</strong> {{ entry.COURSE_ID}}<br>
                    </div>
                    <div class="class-info">
                        <strong>Course Title:</strong> {{ entry.TITLE }}<br>
                    </div>
                    <div class="class-info">
                        <strong>Instructor:</strong> {{ entry.INSTRUCTOR }}<br>
                    </div>
                    <div class="class-info">
                        <strong>Class Time:</strong> {{ entry.CRS_DAYTIME }}<br>
                    </div>
                    <div class="class-info">
                        <strong>Seats Available:</strong> {{ entry.SEATS_AVAIL }}<br>
                    </div>
                    <button type="button" courseURL="{{ courseURL }}" CRN="{{ CRN }}" TITLE="{{ entry.TITLE }}"
                    class="btn btn-secondary" id="add-cart">Add to Cart</button>
                </div>
            {% endif %}
        {% endfor %}
    </ul>
{% else %}
    <h1 class="h3 mb-3 font-weight-normal">No class information available.</h1>
{% endif %}


    <!--Subject Dropdown-->
    {% include 'personal/snippets/subject.html' %}

    <!--Term Dropdown-->
    {% include 'personal/snippets/term.html' %}

    <!--CRN Dropdown-->
    <input type="text" name="crn" id="inputCRN" class="form-control" placeholder="CRN" required
    value="{{ account_form.initial.crn }}" title="Please enter a 5-digit number" minlength="5" maxlength="5">


    {% for field in account_form %}
        <p> 
            {% for error in field.errors %}
                <p style="color: red"></p>{{ error }}</p> 
            {% endfor %}
        </p>
    {% endfor %}
    {% if account_form.non_field_errors %}
        <div style="color: red">
            <p>{{account_form.non_field_errors}}</p>
        </div>

    {% endif %}

    {% if success_msg %}
    <p style="color: green; text-align: center;">{{ success_msg }}</p>
    {% elif failure_msg %}
        <p style="color: red; text-align: center;">{{ failure_msg }}</p>
    {% endif %}
    

    <button id="save-changes-btn" class="btn btn-lg btn-primary btn-block" type="submit">Save changes</button>

</form>


<script>
//Check if the button is pressed

$(document).on('click', '#add-cart', function(e){
    var courseURL = $(this).attr('courseURL');
    var CRN = $(this).attr('CRN');
    var TITLE = $(this).attr('TITLE');

    e.preventDefault();

    $.ajax({
        type: 'POST',
        url: "{% url 'cart_add' %}",
        data: {
            courseURL: courseURL,
            CRN: CRN,
            TITLE: TITLE,
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action: 'post'
        },

        success: function(json){
            document.getElementById('cart_quantity').textContent = json.qty
        },

        error: function(xhr, errmsg, err){
            

        }

    });

})
</script>




{% endblock content %}